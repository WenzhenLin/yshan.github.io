function Player(j){var a=[];var c;var b=j;this.newGame=function(){a=[]};this.deal=function(k){if(k>=0){a.push(k);a.sort(function(m,l){return(m%54)-(l%54)})}else{c.sortCards(a)}};this.checkMakeMaster=function(){var n=c.getMasterSuites(b);var m=0;var o=-1;for(var l=0;l<n.length;++l){var k=c.getPlayerCards(b,n[l]);if(k.length>m){m=k.length;o=n[l]}}if(o!=-1&&(m>=6||c.isFirstGame())){c.makeMaster(b,o)}};this.getCards=function(){return a};this.getCardsCount=function(){return a.length};var d=function(l){for(var k=0;k<a.length;++k){if(a[k]==l){a.splice(k,1);return}}};var h=function(p,l){var o=b%2;var k=p%54;var r=c.descCard(p);var n=(r[2]>0)?"X":r[3];for(var m=0;m<CN;++m){if(m%54>k&&l[m]%2!=o){var q=c.descCard(m);var s=(q[2]>0)?"X":q[3];if(n==s){return false}}}return true};this.koudi=function(t){var v;if(t){v=t}else{v=[];var u=[];var m=c.getMasterSuite();for(var p=0;p<4;++p){var x=SUITES[p];if(x!=m){var r=c.getPlayerCards(b,x);u.push(r)}}u.sort(function(y,s){return y.length-s.length});u.push(c.getPlayerCards(b,"X"));var o=c.getAllCards();for(var p=0;p<u.length&&v.length<8;++p){var k=u[p];var l=c.groupCards(k);for(var n=0;n<l.length&&v.length<8;++n){var q=l[n];if(q.length==1){var t=q[0];if(!h(t,o)){v.push(t)}}}}for(var p=0;p<a.length&&v.length<8;++p){var t=a[p];var w=false;for(var n=0;n<v.length;++n){if(t==v[n]){w=true;break}}if(!w){v.push(t)}}console.log("koudi:"+v)}for(var p=0;p<v.length;++p){d(v[p])}c.koudi(b,v)};var g=function(m){var A=[];var x=m[0][0];var y=c.descCard(x);var w=(y[2]>0)?"X":y[3];var t=[];for(var l=0;l<4;++l){if(l!=b){t.push(c.getPlayerGroupCards(l,w))}}for(var q=0;q<m.length;++q){var s=m[q];var r=s[0]%54;var z=false;for(var o=0;o<t.length&&!z;++o){var u=t[o];for(var n=0;n<u.length&&!z;++n){if(u[n].length>=s.length&&u[n][0]%54>r){z=true}}}if(!z){for(var o=0;o<s.length;++o){A.push(s[o])}}}return A};var f=function(x){var q=x.leader;var u=x.suite;if(x.cards.length>1){q=c.getTurnWinner(x)}var k=(q-x.leader+4)%4;if(q!=x.leader){var v=x.cards[k][0];var m=c.descCard(v);var z=(m[2]>0)?"X":m[3];if(z!=u){return q}}var y=c.groupCards(x.cards[k]);for(var o=x.cards.length;o<4;++o){var l=(x.leader+o)%4;var w=c.getPlayerCards(l,u);if(w.length==0){if(o==x.cards.length){continue}else{return -1}}if(y.length==1&&w.length>=x.cards[0].length){var r=c.groupCards(w);r.sort(function(s,p){if(s.length!=p.length){return p.length-s.length}return c.compareCard(p[0],s[0])});for(var n=0;n<r.length;++n){if(r[n].length>=y[0].length&&c.compareCard(r[n][0],y[0][0])>0){q=l;y=[r[n].slice(0,y[0].length)];break}}}}console.log("predict winner,current player:"+x.cards.length+",winner:"+q);return q};var i=function(){var r=[];while(true){var C=c.getMasterSuite();var l=[];var w=[];var D=[];for(var z=0;z<4;++z){var u=SUITES[z];if(u!=C){var m=c.getPlayerCards(b,u);if(m.length>0){l.push(m);var x=c.groupCards(m);w.push(x);var t=g(x);if(t.length>0){D.push(t)}}}}if(D.length>0){var p=Math.floor((Math.random()*D.length));var v=D[p];for(var z=0;z<v.length;++z){r.push(v[z])}break}var k=[];for(var z=0;z<w.length;++z){var B=w[z];if(B.length<2){k=[B[0]];break}for(var y=0;y<B.length;++y){var A=B[y];if(A.length>1){k.push(A)}}}if(k.length>0){k.sort(function(E,s){if(E.length!=s.length){return s.length-E.length}return E[0]%54-s[0]%54});var A=k[0];for(var z=0;z<A.length;++z){r.push(A[z])}break}var n=c.getPlayerCards(b,"X");if(n.length>0){var B=c.groupCards(n);if(B.length>1){var q=c.getPlayerCards((b+1)%4,"X");var o=c.getPlayerCards((b+3)%4,"X");if(q.length>0||o.length>0){if(n.length>=q.length&&n.length>=o.length){B.sort(function(E,s){var G=c.descCard(E[0]);var F=c.descCard(s[0]);if(G[0]!=F[0]){return G[0]-F[0]}if(E.length!=s.length){return E.length-s.length}if(E.length>1){return c.compareCard(s[0],E[0])}else{return c.compareCard(E[0],s[0])}});var v=B[0];for(var z=0;z<v.length;++z){r.push(v[z])}break}}}}var v=a.slice(0);var B=c.groupCards(v);B.sort(function(G,F){if(G.length!=F.length){return G.length-F.length}var E=c.descCard(G[0]);var s=c.descCard(F[0]);if(E[0]!=s[0]){return E[0]-s[0]}if(E[1]!=s[1]){return E[1]-s[1]}if(E[2]!=s[2]){return E[2]-s[2]}if(E[2]==0){return G[0]%54%13-F[0]%54%13}else{return c.compareCard(G[0],F[0])}});var A=B[0];for(var y=0;y<A.length;++y){r.push(A[y])}break}return r};var e=function(){var x=c.getCurrentTurn();var l=c.getPlayerCards(b,x.suite);var w=[];var M=x.cards[0].length;var E=f(x);var I=c.getTurnScore(x);var o=x.cards.length;if(l.length==0){var p=false;if(E>=0&&E!=((b+2)%4)){p=true}if(o==3){p=p&&I>0}if(p){var C=c.getPlayerCards(b,"X");if(C.length>0){var R=c.groupCards(C);var A=(E-x.leader+4)%4;var N=false;if(A<x.cards.length){var J=c.descCard(x.cards[A][0]);if(J[2]>0){N=true}}if(N){var m=c.groupCards(x.cards[A]);m.sort(function(T,k){if(T.length!=k.length){return k.length-T.length}else{return c.compareCard(k[0],T[0])}});var z=true;for(var H=0;H<m.length;++H){var t=false;for(var G=0;G<R.length;++G){if((R[G].length==m[H].length)&&((z&&c.compareCard(R[G][0],m[H][0])>0)||(!z))){z=false;t=true;for(var F=0;F<R[G].length;++F){w.push(R[G][F])}R.splice(G,1);break}}if(!t){w=[];break}}}else{var m=c.groupCards(x.cards[0]);R.sort(function(V,U){if(V.length!=U.length){return U.length-V.length}var T=c.descCard(V[0]);var k=c.descCard(U[0]);if(T[5]!=k[5]){return k[5]-T[5]}else{return c.compareCard(V[0],U[0])}});for(var H=0;H<m.length;++H){var t=false;for(var G=0;G<R.length;++G){if(R[G].length==m[H].length){t=true;for(var F=0;F<R[G].length;++F){w.push(R[G][F])}R.splice(G,1);break}}if(!t){w=[];break}}}}}}else{if(l.length<=M){for(var H=0;H<l.length;++H){w.push(l[H])}}else{var R=c.groupCards(l);var B=c.groupCards(x.cards[0]);var q;var Q;if(x.suite=="X"&&B.length==1){var S=c.getTurnWinner(x);var A=(S-x.leader+4)%4;var v=x.cards[A][0];var n=c.makeCard("X","A");if(o==1){q=true;Q=false}else{if(o==2){if(A==0&&c.compareCard(v,n)>=0){q=false;Q=true}else{q=true;Q=false}}else{if(A==1){q=false;Q=true}else{if(I>0){q=true;Q=false}else{q=false;Q=false}}}}R.sort(function(X,W){if(X.length!=W.length){return X.length-W.length}var V=c.descCard(X[0]);var U=c.descCard(W[0]);if(U[5]!=V[5]){return Q?(U[5]-V[5]):(V[5]-U[5])}if(!q){return c.compareCard(X[0],W[0])}var T=(c.compareCard(X[0],v)>0);var k=(c.compareCard(W[0],v)>0);if(T!=k){return c.compareCard(W[0],X[0])}else{return c.compareCard(X[0],W[0])}})}else{if(E==b){q=true;Q=false}else{if(E==((b+2)%4)){q=false;Q=true}else{q=false;Q=false}}R.sort(function(V,U){if(V.length!=U.length){return V.length-U.length}var T=c.descCard(V[0]);var k=c.descCard(U[0]);if(k[5]!=T[5]){return Q?(k[5]-T[5]):(T[5]-k[5])}return q?c.compareCard(U[0],V[0]):c.compareCard(V[0],U[0])})}for(var H=0;H<B.length;++H){var K=B[H].length;var y=false;var u=K;var r=K;while(r>0&&K>=2){var s=Math.floor(u/K);for(var D=0;D<s;++D){for(var G=0;G<R.length;++G){if(R[G].length>=K){r-=K;for(var F=0;F<K;++F){w.push(R[G][F])}if(R[G].length==K){R.splice(G,1)}else{R[G].splice(0,K)}break}}}K-=2}}for(var H=0;H<R.length&&w.length<M;++H){var L=R[H];for(var G=0;G<L.length&&w.length<M;++G){w.push(L[G])}}for(var H=0;H<l.length&&w.length<M;++H){var P=l[H];var y=false;for(var G=0;G<w.length;++G){if(P==w[G]){y=true;break}}if(!y){w.push(P)}}}}if(w.length<M){var D=a.slice(0);for(var H=0;H<w.length;++H){for(var G=0;G<D.length;++G){if(D[G]==w[H]){D.splice(G,1);break}}}var O=c.groupCards(D);O.sort(function(V,U){if(V.length!=U.length){return V.length-U.length}var T=c.descCard(V[0]);var k=c.descCard(U[0]);if(T[0]!=k[0]){return T[0]-k[0]}if(T[1]!=k[1]){return T[1]-k[1]}if(T[2]!=k[2]){return T[2]-k[2]}if(T[5]!=k[5]){return(E==(b+2)%4)?(k[5]-T[5]):(T[5]-k[5])}if(T[2]==0){return V[0]%54%13-U[0]%54%13}else{return c.compareCard(V[0],U[0])}});for(var H=0;H<O.length&&w.length<M;++H){var L=O[H];for(var G=0;G<L.length&&w.length<M;++G){w.push(L[G])}}}return w};this.play=function(n){var k;if(n){k=n}else{if(c.isLeader()){k=i()}else{var m=c.getCurrentTurn();k=e()}}if(c.play(b,k)){for(var l=0;l<k.length;++l){d(k[l])}}};this.setDirector=function(k){c=k}};